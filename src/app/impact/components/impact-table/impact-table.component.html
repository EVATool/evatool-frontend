<div class="container">
  <ng-scrollbar>
    <table mat-table [dataSource]='tableDataSource' matSort>
      <caption class=" screen-reader-only">List of impacts</caption>

      <ng-container matColumnDef='uniqueString'>
        <th scope="col" mat-header-cell *matHeaderCellDef mat-sort-header [resizeColumn]="true" [index]="0">
          <div matTooltip="An artificial ID" matTooltipHideDelay="100" matTooltipPosition="above">ID</div>
        </th>

        <td mat-cell *matCellDef='let impact'>
          <div [innerHTML]="impact.uniqueString | highlightSearch: filterValues.highlight">

          </div>
        </td>
      </ng-container>

      <ng-container matColumnDef='stakeholder'>
        <th scope="col" mat-header-cell *matHeaderCellDef mat-sort-header>
          <div matTooltip="The affected stakeholder" matTooltipHideDelay="100" matTooltipPosition="above">Stakeholder
          </div>
        </th>

        <td mat-cell *matCellDef='let impact'>
          <mat-list class="list-horizontal">
            <mat-list-item>
              <app-stakeholder-level [showDescription]="false" [editable]="false" [level]="impact.stakeholder.level"></app-stakeholder-level>
            </mat-list-item>
            <mat-list-item>
              <mat-form-field>
                <mat-select [(ngModel)]="impact.stakeholder" (selectionChange)="stakeholderChange(impact, $event)">
                  <mat-select-trigger>
                    <div [innerHTML]="impact.stakeholder.name | highlightSearch: filterValues.highlight">

                    </div>
                  </mat-select-trigger>
                  <mat-option *ngFor="let stk of impactDataService.stakeholderDataService.stakeholders" [value]="stk">
                    <div [innerHTML]="stk.name | highlightSearch: filterValues.highlight">
                    </div>
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </mat-list-item>
          </mat-list>
        </td>
      </ng-container>

      <ng-container matColumnDef='valueEntity'>
        <th scope="col" mat-header-cell *matHeaderCellDef mat-sort-header>
          <div matTooltip="The value affecting the stakeholder" matTooltipHideDelay="100" matTooltipPosition="above">
            Value
          </div>
          <mat-icon *ngIf="impactDataService.impactsLoaded" id="valueEntity-modal"
                    (click)="$event.stopPropagation(); openValueModal();">info
          </mat-icon>
        </th>

        <td mat-cell *matCellDef='let impact'>
          <mat-form-field>
            <mat-select [(ngModel)]="impact.valueEntity" (selectionChange)="valueEntityChange(impact, $event)">
              <mat-select-trigger>
                <div [innerHTML]="impact.valueEntity.name | highlightSearch: filterValues.highlight">

                </div>
              </mat-select-trigger>
              <mat-option *ngFor="let val of impactDataService.valueDataService.values"
                          [value]="val" [disabled]="val.archived">
                <div [innerHTML]="val.name | highlightSearch: filterValues.highlight">
                </div>
              </mat-option>
            </mat-select>
          </mat-form-field>
        </td>
      </ng-container>

      <ng-container matColumnDef='value'>
        <th scope="col" mat-header-cell *matHeaderCellDef mat-sort-header>
          <div matTooltip="The impact (Goal or Risk)" matTooltipHideDelay="100" matTooltipPosition="above">Impact</div>
        </th>

        <td mat-cell *matCellDef='let impact'>
          <div class="impact-slider-container">
            <app-impact-slider [deadzone]='0.3' [value]="impact.value"
                               (sliderValueChange)="valueChange(impact, $event)">
            </app-impact-slider>
          </div>
        </td>
      </ng-container>

      <ng-container matColumnDef='description'>
        <th scope="col" mat-header-cell *matHeaderCellDef mat-sort-header>
          <div matTooltip="The impact description" matTooltipHideDelay="100" matTooltipPosition="above">Description
          </div>
        </th>
        <td mat-cell *matCellDef='let impact' (click)="impact.edit = true">
          <div class="description-wrapper">
            <div class="description-container">
              <div *ngIf="impact.edit">
                 <textarea matInput cdkTextareaAutosize [(ngModel)]="impact.description" placeholder="Describe the impact..."
                    (change)="descriptionChange(impact, $event)"></textarea>
              </div>
              <div [innerHTML]="impact.description | highlightSearch: filterValues.highlight " *ngIf="!impact.edit">
              </div>
            </div>
            <div class="delete-button-container">
              <button mat-fab (click)="deleteImpact(impact)" matTooltip="Delete Impact" matTooltipHideDelay="100"
                      matTooltipPosition="above">
                <mat-icon>delete</mat-icon>
              </button>
            </div>
          </div>
        </td>
      </ng-container>

      <tr mat-header-row [style.min-height]="0" *matHeaderRowDef="displayedColumns; sticky: true"></tr>
      <tr mat-row (mouseleave)="row.edit= false" [ngClass]="{'highlight': row.highlight}" *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>
  </ng-scrollbar>

  <div class="add-impact-button-container">
    <div class="add-impact-button-container">
      <button type="button" mat-fab matTooltip="Add a new impact" matTooltipHideDelay="100" matTooltipPosition="above"
              (click)="addButtonClicked()">
        <mat-icon>add</mat-icon>
      </button>
    </div>

    <div class="add-impact-text-container">
      <p id='text'>Impact</p>
    </div>
  </div>
</div>

<div class="scroll-to-top" [hidden]="!windowScrolled">
  <button type="button" mat-fab (click)="scrollToTop()" matTooltip="Scroll to Top" matTooltipHideDelay="100"
          matTooltipPosition="above">
    <mat-icon>arrow_upward</mat-icon>
  </button>
</div>

